**CASL2 演習3**

- 副プログラム: `ADD64`
    - 64ビット符号なし整数の加算を行う
    - 64ビット符号なし整数:
        - `[N番地: 16ビット, N+1番地: 16ビット, N+2番地: 16ビット, N+3番地: 16ビット]`
    - 引数 GR1, GR2:
        - 64ビット符号なし整数を格納する領域の先頭アドレス
        - 各領域はそれぞれ連続した4語から成る
    - 参照戻り値 GR1:
        - 64ビット符号なし整数: GR1 + GR2 の結果を格納した領域の先頭アドレス
        - 加算時、桁あふれは発生しない想定
    - 副プログラムから戻る時、汎用レジスタ GR1〜GR7 の内容はもとに戻す

```
; 64ビット符号なし整数を加算するプログラム
ADD64 START
      ; GR1〜7の内容をスタックに退避
      ; 戻り値GR0を0初期化
      ; GR3にGR1の最下位16ビットのアドレスをセット
      ; GR4にGR2の最下位16ビットのアドレスをセット
      ; ループ開始: 16ビットごとの加算を下位から実行
      ; | 桁上がり用バッファ: GR5 = 0
      ; | GR0 += value(GR3)
      ; | オーバフローが起こった場合はGR5に1をセット
      ; | GR0 += value(GR4)
      ; | オーバフローが起こった場合はGR5に1をセット
      ; | 加算結果をGR3ポインタに格納
      ; | 桁上がりバッファをGR0にセット
      ; | GR3ポインタがGR1(先頭アドレス)に達したらループ終了
      ; | GR3ポインタをデクリメント
      ; | GR4ポインタをデクリメント
      ; GR1〜7の内容をスタックから戻す
      RET ; 呼び出し元に戻る
      END
```

- 副プログラム: `MUL32`
    - 32ビット符号なし整数の乗算を行う
    - 32ビット符号なし整数:
        - `[N番地: 16ビット, N+1番地: 16ビット]`
    - 引数 GR1, GR2:
        - 32ビット符号なし整数を格納する領域の先頭アドレス
        - 各領域はそれぞれ連続した2語から成る
    - 参照戻り値 GR3:
        - 64ビット符号なし整数: GR1 * GR2 の結果を格納する領域の先頭アドレス
        - 領域は連続した4語から成る
    - 副プログラムから戻る時、汎用レジスタ GR1〜GR7 の内容はもとに戻す
- 領域: `TEMP`
    - 乗算結果を格納する64ビット符号なし整数領域
    - 4語文の領域を確保する

```
; 32ビット符号なし整数の乗算を行うプログラム
MUL32 START
      ; GR1〜7の内容をスタックに退避
      ; GR7にTEMPの先頭アドレスをセット
      ; 被乗数の値をTEMPから始まる4語の領域の下位2語に格納
      ; GR0 = 0
      ; TEMPから始まる4語の領域の上位2語にGR0(0)を格納
      ; GR3から始まる4語の領域にGR0(0)を格納
      ; ループカウンタ: GR5 = 0
      ; 下位1ビット〜上位1ビットまで32ビット分ループ
      ; | 乗数の先頭アドレス(GR2)をGR4に退避
      ; | GR6 = GR5(ループカウンタ)
      ; | GR6 >= 16: 上位ビットの計算なら
      ; | | GR0 = value(GR2[0])
      ; | | GR0(乗数)を ループカウンタ-16 の分だけ右シフト
      ; | GR6 < 16: 下位ビットの計算なら
      ; | | GR0 = value(GR2[1])
      ; | | GR0(乗数)を ループカウンタ の分だけ右シフト
      ; | GR0(乗数)の最下位1ビットが1なら
      ; | | GR1(乗算結果) = GR3(被乗数)
      ; | | GR2にTEMPの先頭アドレス(乗数)をセット
      ; | | 64ビット符号なし加算を実行 => GR1(乗算結果)
      ; | ループカウンタが31ならループ終了
      ; | ループカウンタをインクリメント
      ; | 被乗数を左に1ビットシフト（TEMPを2倍にする）
      ; | GR4に退避したアドレスをGR2に戻す
      ; GR1〜7の内容をスタックから戻す
      RET ; 呼び出し元に戻る
      END

; 乗算結果の64ビット符号なし整数用の領域確保
; TEMP = new WORD[4]
```
