**CASL2 演習2**
- プログラム:
    - 0〜65534の整数を表す数字から成る文字列（数字列）を数値に変換する
    - 文字列は、DC命令の文字定数と同じ形式で主記憶に格納される
        - 例: 数字列 "567"
            - `[#0035, #0036, #0037]`
    - 以下の各プログラムから戻る時、汎用レジスタ GR1〜GR7 の内容は元に戻す
- 副プログラム: `DTOB`
    - 引数 GR1:
        - 数字列が格納されている領域の先頭アドレス
    - 引数 GR2:
        - 数字列の長さ
    - 戻り値 GR0:
        - 数字列 GR1 を数値に変換した値

```
; 数字列を数値に変換するプログラム
DTOB START
     ; GR1〜7の内容をスタックに退避
     ; 数字列の最後尾+1を GR2 に代入
     ; 戻り値の初期化: GR0 = 0
     ; <数字列を[0]〜[最後尾+1]まで走査>
     ; | while GR1 < GR2
     ; | | 数字列1文字を GR4 に取り出す
     ; | | GR4 を数値に変換
     ; | | <GR0 を10倍（桁上げ）して GR4 を加算>
     ; | | | GR0 を2倍に
     ; | | | GR5 = GR0
     ; | | | GR5 を4倍に（GR5 = 4*GR0）
     ; | | | GR0 = GR0 + GR5 (= 5*GR0 = 元の10倍)
     ; | | | GR0 = GR0 + GR4
     ; | | 先頭アドレスをインクリメント: GR1 = GR1[1]
     ; GR1〜7の内容をスタックから戻す
     RET ; 呼び出し元に戻る
     END
```

- 副プログラム: `GETWD`
    - 文字列の先頭から数字列を探索し、順に対応する数値を管理テーブルに格納する
    - 引数 GR1:
        - 文字列が格納されている領域の先頭アドレス
            - 文字列は1つ以上の空白文字で区切られた任意の個数の数字列を含む
            - 最後はピリオドで終わる
            - 最後の数字列とピリオドの間に1つ以上の空白文字があっても良い
            - 先頭に1つ以上の空白文字を含んでも良い
    - 引数 GR2:
        - 管理テーブルの先頭アドレス
    - 処理:
        - 管理テーブルには、文字列中に数字列が現れるごとに、順に1語から成る要素を追加し、数字列を数値に変換して格納する
        - 管理テーブルの最後に1語からなる要素を追加し、数値の終わりを示す印として -1 を格納する
- 副プログラム: `SETWD`
    - 数字列を数値に変換して管理テーブルポインタに格納する
    - 参照引数 GR3:
        - 数字列の処理状態フラグ
            - -1: 未処理中
            - 0: 処理中
    - 参照引数 GR6:
        - 文字列ポインタ
    - 参照引数 GR7:
        - 管理テーブルポインタ

```
; 文字列を数値配列として管理テーブルに格納するプログラム
GETWD START
      ; GR1〜7の内容をスタックに退避
      ; 引数文字列の先頭アドレスをGR6にセット
      ; 引数管理テーブルの先頭アドレスをGR7にセット
      ; 数字列の処理状態フラグ: GR3 = -1（未処理）
      ; 文字列先頭の一つ前のアドレスにポインタ(GR6)を置く
      ; ループ開始: ポインタ(GR6)を一つ先に進める
      ; | GR4にポインタ位置の1文字を取り出す
      ; | GR4が'.'ならループ終了
      ; | GR4が' 'ならSETWD を呼び出す
      ; | 数字列の処理中でない(GR3!=0)なら
      ; | | 数字列の処理中フラグを立てる: GR3 = 0
      ; | | 現在処理中の数字列の先頭アドレスをGR1に退避
      ; 最後の数字列を管理テーブルポインタに格納
      ; GR2 = -1 (管理テーブルの終了位置標識)
      ; 管理テーブルポインタにGR2(=-1)格納
      ; GR1〜7の内容をスタックから戻す
      RET ; 呼び出し元に戻る
      END

; 数字列を数値に変換して管理テーブルポインタに格納するプログラム
SETWD START
      ; 数字列処理フラグが0でないなら終了
      ; GR2に現在処理中の数字列の先頭アドレスをセット
      ; DTOB を呼び出して数字列を数値に変換
      ; 変換結果を管理テーブルポインタに格納
      ; 数字列処理フラグを-1にする
      ; 管理テーブルポインタをインクリメント
      RET
      END
```

- 副プログラム: `MULT`
    - 2つの数字列を空白文字で区切った文字列に対して、2つの数字列を数値に変換したものを乗算した結果を返す（乗算においてあふれは発生しないと想定）
    - 引数 GR1:
        - 文字列の先頭アドレス
    - 戻り値 GR0:
        - 乗算結果の数値
- 領域: `CTBL`
    - `GETWD`プログラムで使用する管理テーブル
    - 3語文の領域を確保する（2つの数値 + 最後の`-1` の分）

```
; 文字列内の2つの数字列を乗算するプログラム
MULT START
     ; GR1〜7の内容をスタックに退避
     ; CTBLの先頭アドレスをGR2にセット
     ; GETWD呼び出し => GR2 = [数値,数値,-1]
     ; 被乗数をGR4にセット
     ; 乗数をGR5にセット
     ; 戻り値を0初期化
     ; GR5が0ならそのまま終了 => 戻り値 = 0
     ; GR0 = GR4 * GR5 実行
     ; GR1〜7の内容をスタックから戻す
     RET ; 呼び出し元に戻る
     END

; GETWD用管理テーブル確保
; CTBL = new WORD[3]
```
